<!DOCTYPE html>
<html>
<head>
<title>Digit Drawing Canvas</title>
<style>
  body { text-align: center; font-family: Arial; }
  canvas {
    border: 2px solid black;
    background: white;
    cursor: crosshair;
  }
</style>
</head>
<body>

<h2>Draw a Digit (0–9)</h2>

<canvas id="canvas" width="280" height="280"></canvas><br><br>

<button onclick="clearCanvas()">Clear</button>
<button onclick="saveImage()">Save Image</button>
<button onclick="get28x28()">Get 28×28 Pixel Data</button>

<script>
// =======================================================
// Setup canvas
// =======================================================
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

// Force background white (fix transparent -> zero problem)
ctx.fillStyle = "black";
ctx.fillRect(0, 0, canvas.width, canvas.height);

let painting = false;

// =======================================================
// Drawing logic
// =======================================================
canvas.addEventListener("mousedown", start);
canvas.addEventListener("mouseup", stop);
canvas.addEventListener("mousemove", draw);

function start(e) {
    painting = true;
    draw(e);
}

function stop() {
    painting = false;
    ctx.beginPath();
}

function draw(e) {
    if (!painting) return;

    let rect = canvas.getBoundingClientRect();

    ctx.lineWidth = 40;
    ctx.lineCap = "round";
    ctx.strokeStyle = "white";
    ctx.globalAlpha = 1.0;

    ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
}

// =======================================================
// Clear canvas
// =======================================================
function clearCanvas() {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

// =======================================================
// Save Image as PNG
// =======================================================
function saveImage() {
    let link = document.createElement("a");
    link.download = "digit.png";
    link.href = canvas.toDataURL();
    link.click();
}

// =======================================================
// Convert drawing -> 28×28 grayscale pixel data
// =======================================================
function get28x28() {

    let smallCanvas = document.createElement("canvas");
    smallCanvas.width = 28;
    smallCanvas.height = 28;
    let smallCtx = smallCanvas.getContext("2d");

    // background white
    smallCtx.fillStyle = "white";
    smallCtx.fillRect(0, 0, 28, 28);

    // draw big -> small
    smallCtx.drawImage(canvas, 0, 0, 28, 28);

    let data = smallCtx.getImageData(0, 0, 28, 28).data;

    let arr = [];
    for (let i = 0; i < data.length; i += 4) {
        let r = data[i];
        let g = data[i+1];
        let b = data[i+2];

        let gray = (r + g + b) / 3 / 255; // normalize 0-1
        arr.push(gray);
    }

    console.log("Flattened 28×28 array:", arr);
    alert("Pixel data printed in console!");
}

</script>
</body>
</html>
